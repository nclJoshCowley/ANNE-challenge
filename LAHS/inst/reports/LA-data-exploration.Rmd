---
title: "Local Authority Data Exploration"
author: "Josh Cowley"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    number_sections: true
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
params:
  use_data: TRUE
---

```{r setup, include = FALSE}
# CRAN
library(tidyverse)
library(usethis)
library(kableExtra)

# Github
library(LAHS)
LAHS::common_report_setup()
```

```{r setup-data}
data("LAHS", package = "LAHS")
data("LACO2", package = "LAHS")

LACO2_domestic <- dplyr::filter(LACO2, .data$CO2_SECTOR == "Domestic")
rm(LACO2)
```

# Introduction

This report aims to explore the data by collating visualisations that will be
precursors to more polished visualisations to be delivered.
Each section asks a questions of the data.

# Domestic CO2 Emissions (DCE)

## Degree under LA Influence?

No visualisation here but note the data is split into CO2 emissions and CO2 
emissions under the influence of the LA. For domestic emissions, these values
are always the same.

## DCE trend over time?

### By LA

We see that the **domestic** emissions under LA influence appear to be 
decreasing over time for electricity and to some extent gas.

```{r vis_trend_per_subsector}
vis_trend_per_subsector <- function(tb, ...) {
  default_mapping <- rlang::exprs(x = .data$YEAR)
  new_mapping <- utils::modifyList(default_mapping, rlang::enexprs(...))
  
  ggplot2::ggplot(tb, do.call(ggplot2::aes, new_mapping)) +
    ggplot2::geom_line() +
    ggplot2::facet_wrap(ggplot2::vars(.data$CO2_SUBSECTOR))
}
```

```{r}
LACO2_domestic %>%
  vis_trend_per_subsector(y = .data$CO2_LA_EMISSIONS, colour = .data$LA_NAME) +
  ggplot2::guides(colour = "none")
```

### By Region

Aggregating (total DCE) over regions, we still see the same trend but the plot 
is still too busy (12 regions).

Also, it seems as though temporal trends in domestic emissions are common 
across regions.

```{r}
LACO2_domestic %>%
  dplyr::group_by(.data$LA_REGION, .data$CO2_SUBSECTOR, .data$YEAR) %>%
  dplyr::summarise(
    CO2_LA_EMISSIONS = sum(.data$CO2_LA_EMISSIONS),
    .groups = "keep"
  ) %>%
  vis_trend_per_subsector(y = .data$CO2_LA_EMISSIONS, colour = .data$LA_REGION)
```

## Population trends?

We should expect population to be increasing, and that is what we see.

```{r}
LACO2_domestic %>%
  dplyr::group_by(.data$LA_REGION, .data$YEAR) %>%
  dplyr::summarise(LA_POPULATION = sum(.data$LA_POPULATION), .groups = "keep") %>%
  ggplot(aes(x = .data$YEAR, y = .data$LA_POPULATION, colour = .data$LA_REGION)) +
  ggplot2::geom_line()
```

## Area trends?

Hard to see why LA areas would be changing but the following shows they are not
necessarily constant for one reason or another.

```{r}
LACO2_domestic %>%
  dplyr::group_by(.data$LA_REGION, .data$YEAR) %>%
  dplyr::summarise(LA_AREA = sum(.data$LA_AREA), .groups = "keep") %>%
  ggplot2::ggplot(ggplot2::aes(
    x = .data$YEAR,
    y = .data$LA_AREA,
    colour = .data$LA_REGION
  )) +
  ggplot2::geom_line()
```
