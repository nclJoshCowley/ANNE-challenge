---
title: "Local Authority Data Exploration"
author: "Josh Cowley"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    number_sections: true
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
params:
  use_data: TRUE
---

```{r setup, include = FALSE}
# CRAN
library(tidyverse)
library(usethis)
library(kableExtra)

# Github
library(LAHS)
LAHS::common_report_setup()
```

```{r}
data("LAHS", package = "LAHS")
data("LACO2", package = "LAHS")
```

# Introduction

This report aims to explore the data by collating visualisations that will be
precursors to more polished visualisations to be delivered.
Each section asks a questions of the data.

# Domestic Emissions trend?

## By LA

We see that the **domestic** emissions under LA influence appear to be 
decreasing over time for electricity and to some extent gas.

```{r vis_emissions_over_time_by_subsector}
vis_emissions_over_time_by_subsector <- function(x, colour, legend = FALSE) {
  x %>%
    ggplot2::ggplot(ggplot2::aes(
      x = .data$YEAR,
      y = .data$CO2_LA_EMISSIONS,
      colour = .data[[{{colour}}]]
    )) +
    ggplot2::geom_line() +
    ggplot2::facet_wrap(ggplot2::vars(.data$CO2_SUBSECTOR))
}
```

```{r}
LACO2 %>%
  dplyr::filter(.data$CO2_SECTOR == "Domestic") %>%
  vis_emissions_over_time_by_subsector(colour = "LA_NAME") +
  ggplot2::guides(colour = "none")
```

## By Region

Aggregating over regions, we still see the same trend but the plot is still too 
busy (12 regions).

Also, it seems as though temporal trends in domestic emissions are common 
across regions.

```{r}
LACO2 %>%
  dplyr::filter(.data$CO2_SECTOR == "Domestic") %>%
  dplyr::group_by(.data$LA_REGION, .data$CO2_SUBSECTOR, .data$YEAR) %>%
  dplyr::summarise(
    CO2_LA_EMISSIONS = sum(.data$CO2_LA_EMISSIONS),
    .groups = "keep"
  ) %>%
  vis_emissions_over_time_by_subsector(colour = "LA_REGION")  
```



